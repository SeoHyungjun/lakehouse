# Airflow Development Environment Configuration
# Platform defaults: platform/airflow/values.yaml
# Override ONLY environment-specific values

airflow:
  # Dev webserver with minimal resources
  # Note: At least 512Mi required to avoid OOMKilled
  webserver:
    resources:
      requests:
        memory: 512Mi
        cpu: 100m  # Lower than platform default (250m)
      limits:
        memory: 1Gi
        cpu: 250m  # Lower than platform default (500m)

  # Dev scheduler with increased memory for Airflow 3.0
  # Note: Airflow 3.0 requires 2Gi to avoid OOMKilled
  scheduler:
    resources:
      requests:
        memory: 1Gi  # Higher than platform default (512Mi)
        cpu: 250m
      limits:
        memory: 2Gi  # Higher than platform default (1Gi)
        cpu: 500m

  # PostgreSQL with minimal resources for development
  postgresql:
    primary:
      persistence:
        size: 2Gi  # Minimal for dev
      resources:
        requests:
          memory: 256Mi  # Lower than platform default
          cpu: 100m  # Lower than platform default
        limits:
          memory: 512Mi  # Lower than platform default
          cpu: 250m  # Lower than platform default

  # GitSync configuration for DAG deployment
  dags:
    gitSync:
      enabled: true
      repo: https://github.com/SeoHyungjun/lakehouse-dags.git
      branch: main
      depth: 1
      wait: 60
      maxFailures: 0
      credentialsSecret: git-sync-cred

  # Development-specific Airflow configuration
  config:
    core:
      dags_folder: "/opt/airflow/dags/repo/dags"
      load_connections: "True"
      parallelism: 8  # Lower than platform default (32)
      max_active_tasks_per_dag: 4  # Lower than platform default (16)
      max_active_runs_per_dag: 4  # Lower than platform default (16)

    webserver:
      expose_config: "True"
      rbac: "False"  # Disabled for dev (platform: True)
      authenticate: "False"  # Disabled for dev (platform: True)
      base_url: "http://airflow-api-server.lakehouse-platform.svc.cluster.local:8080"

    kubernetes:
      delete_worker_pods: "True"
      delete_worker_pods_on_failure: "False"

    elasticsearch:
      enabled: false

    logging:
      logging_level: "DEBUG"  # More verbose for dev (platform: INFO)
      remote_logging: "True"
      remote_base_log_folder: "s3://lakehouse-dev-raw/airflow-logs/"
      remote_logging_conn_id: "aws_default"
      encryption_secret_key: ""

    # S3 connection for remote logging (MinIO)
    celery:
      s3_conn_id: aws_default

  # Triggerer disabled for development (saves resources)
  triggerer:
    enabled: false

