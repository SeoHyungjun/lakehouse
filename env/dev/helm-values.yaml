# Development Environment - Helm Values Overrides
#
# This file contains Helm value overrides for all platform components
# in the development environment.
#
# Usage:
#   helm install <component> ./platform/<component> \
#     --values env/dev/helm-values.yaml

# ============================================================================
# MinIO (Object Storage)
# ============================================================================

minio:
  mode: standalone
  replicas: 1
  
  persistence:
    enabled: true
    size: 10Gi
    storageClass: standard
  
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 500m

  # Use SealedSecret for credentials
  existingSecret: "minio-creds"

  buckets:
    - name: lakehouse-dev-warehouse
      policy: none
      purge: false

# ============================================================================
# Iceberg Catalog
# ============================================================================

icebergCatalog:
  replicaCount: 1
  
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m
  
  persistence:
    enabled: true
    size: 5Gi
  
  catalog:
    warehouse: s3://lakehouse-dev-warehouse/
    s3:
      endpoint: http://minio.lakehouse-platform.svc.cluster.local:9000
      existingSecret: "minio-creds"

# ============================================================================
# Trino (Query Engine)
# ============================================================================

trino:
  server:
    workers: 2
    autoscaling:
      enabled: false
  
  coordinator:
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 1000m
  
  worker:
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 1000m
  
  additionalCatalogs:
    iceberg: |
      connector.name=iceberg
      iceberg.catalog.type=rest
      iceberg.rest-catalog.uri=http://iceberg-catalog.lakehouse-platform.svc.cluster.local:8181
      hive.s3.endpoint=http://minio.lakehouse-platform.svc.cluster.local:9000
      hive.s3.path-style-access=true
      s3.aws-access-key=${ENV:S3_ACCESS_KEY}
      s3.aws-secret-key=${ENV:S3_SECRET_KEY}

  env:
    - name: S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: minio-creds
          key: accessKeyId
    - name: S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: minio-creds
          key: secretAccessKey

# ============================================================================
# Observability (Prometheus + Grafana)
# ============================================================================

observability:
  prometheus:
    retention: 3d
    storageSize: 10Gi
    replicas: 1
    
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 1Gi
        cpu: 500m
  
  grafana:
    replicas: 1
    # adminPassword should be set via SealedSecret in production
    # For development, use default and update after first login
    
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 250m
  
  alertmanager:
    enabled: false  # Disable alerts in development

# ============================================================================
# ArgoCD (GitOps)
# ============================================================================

argocd:
  server:
    replicas: 1
    
    resources:
      requests:
        memory: 128Mi
        cpu: 50m
      limits:
        memory: 256Mi
        cpu: 250m
  
  repoServer:
    replicas: 1
    
    resources:
      requests:
        memory: 128Mi
        cpu: 50m
      limits:
        memory: 256Mi
        cpu: 250m
  
  controller:
    replicas: 1
    
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 500m
  
  # Development settings
  configs:
    params:
      server.insecure: true  # No TLS in development
